<!DOCTYPE html>
<html>
<head>
    <title>iOS支付优化</title>

    <meta charset="UTF-8"/>

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>

    <meta name="HandheldFriendly" content="true"/>

    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>

    <meta name="apple-mobile-web-app-capable" content="yes"/>

    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>

    <link href="../asset/fit/basic_markdown.css" type="text/css" rel="stylesheet"/>
    <link href="../asset/fit/style.css" type="text/css" rel="stylesheet"/>
    <link href="../asset/fit/sidebar/auto_sidebar.css" type="text/css" rel="stylesheet"/>

    <style type="text/css">
        body {margin-left: 270px}
        .index {width: 270px}

        
            span.md_line{margin-bottom:0.5em; display:block; line-height:1.89}
            .md_line br{ display: none;}
            
    </style>

    <script>
        var flowchat_options = {
            'x': 0, 'y': 0, 'line-width': 1, 'line-length': 50, 'text-margin': 10, 'font-size': 13,
            'font-color': '#3c3c3c', 'line-color': '#666666', 'element-color': '#666666', 'fill': 'transparent',
            'yes-text': 'yes', 'no-text': 'no', 'arrow-end': 'block', 'class': 'flowchart', 'scale': 1,
            'symbols': { 'start': {}, 'end': {}, 'condition': {}, 'inputoutput': {}, 'operation': {}, 'subroutine': {}}
        }
    </script>
    <script type="text/javascript" src="../asset/other/raphael-min.js"></script>
    <script type="text/javascript" src="../asset/other/flowchart.js"></script>
    <script type="text/javascript" src="../asset/other/echarts.min.js"></script>

    <link href="../asset/other/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
    <script type="text/javascript" src="../asset/other/mermaid/mermaid.min.js"></script>


</head>

<body>





<div class="sidebar">
    <div class="sidebar_body">
        <div class="index">
            <ul class="index_body">
                <li class="title">
                    <a href="../index.html">document</a>
                </li>
                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="../更新记录.html" ><b>1</b> 更新记录</a>
        
            
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>2</b> 需求列表</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item active">
        
        
        <a class="link_in_site" href="../需求列表/iOS支付优化.html" ><b>2.1</b> iOS支付优化</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../需求列表/课程砍价.html" ><b>2.2</b> 课程砍价</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../需求列表/新人红包.html" ><b>2.3</b> 新人红包</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../需求列表/红包转增.html" ><b>2.4</b> 红包转增</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
            </ul>

        </div>

    </div>
</div>

<div class="content">
    <div class="content_body">
        <h2 class="post_title">
            iOS支付优化
        </h2>
        <div class="post_body">
            <div class="markdown">
                <div class="toc_container">
<div class="toc"><ul>
<li>
<a href="#toc_0">1. 需求背景</a>
</li>
<li>
<a href="#toc_1">2. 支付流程优化</a>
</li>
<li>
<a href="#toc_2">3. 交互</a>
<ul>
<li>
<a href="#toc_3">3.1 提醒弹窗</a>
</li>
<li>
<a href="#toc_4">3.2 客服发送图文消息</a>
</li>
</ul>
</li>
</ul>
</div>
</div><h2 id="toc_0" class="h16 md_first_h">1. 需求背景</h2>
<p class="md_block  md_has_block_below md_has_block_below_blockquote">
    <span class="md_line md_line_start md_line_end">因苹果公司的政策问题，iOS版的微信小程序支付虚拟商品时，支付接口暂不能用。</span>
</p>

<blockquote class="blockquote_lines_1">
<p class="md_block">
    <span class="md_line md_line_start md_line_end"> 现在微信也在和苹果交涉当中，后续随时可能出现反转。需要不断跟进最新的消息。</span>
</p>

</blockquote>
<h2 id="toc_1" class="h16">2. 支付流程优化</h2>
    <div id="Z5Z9FnRKMmmsq4CJvsQU9QK" class="flow-graphic"> </div>
    <script>
    var diagram = flowchart.parse('st=>start:  ▲小程序中点击支付按钮\ndialog=>operation:  弹窗提醒用户在客服消息中发送课程ID\nclick=>operation:  ▲用户点击弹窗的“立即购买”\nmsg1=>operation:  跳到小程序客服界面\nrepay=>operation:  ▲用户发送课程ID，自动回复课程购买链接\nopenURL=>operation:  ▲点击消息打开对应的H5课程\npay=>operation:  ▲在H5中支付\nend=>end:  支付完成\n\nst->dialog->click->msg1->repay->openURL->pay->end\n');
    diagram.drawSVG('Z5Z9FnRKMmmsq4CJvsQU9QK');
    </script> 
    
<!--block_code_end-->
<p class="md_block">
    <span class="md_line md_line_start md_line_end">在流程图中，▲标志代表用户自己手动操作。</span>
</p>

<h2 id="toc_2" class="h16">3. 交互</h2><blockquote class="blockquote_lines_1">
<p class="md_block">
    <span class="md_line md_line_start md_line_end">小程序和H5中，课程详情页从后台到前台时，数据需自动刷新。</span>
</p>

</blockquote>
<h3 id="toc_3" class="h16">3.1 提醒弹窗</h3>
<p class="md_block">
    <span class="md_line md_line_dom_embed md_line_with_image md_line_start md_line_end"><img onerror="this.src='../../需求列表/_image/2018-05-18/2018-05-22-11-33-01.png';this.onerror=null;"  class="md_compiled " src="/需求列表/_image/2018-05-18/2018-05-22-11-33-01.png" alt="" title="" ></span>
</p>


<p class="md_block">
    <span class="md_line md_line_start"><code>- 课程码</code>：课程都应的ID， 点击该课程码，则Toast提醒 “课程码已复制到剪切板”<br /></span>
    <span class="md_line"><code>- 触发时机</code>：当用户点击『立即支付』按钮时，弹窗提醒<br /></span>
    <span class="md_line md_line_end"><code>- 点击『立即购买』</code>：跳到客服界面，并且发送图文消息给用户。</span>
</p>

<h3 id="toc_4" class="h16">3.2 客服发送图文消息</h3>
<p class="md_block  md_has_block_below md_has_block_below_blockquote">
    <span class="md_line md_line_dom_embed md_line_start md_line_end"><strong>消息格式</strong></span>
</p>

<blockquote class="blockquote_lines_1">
<p class="md_block">
    <span class="md_line md_line_dom_embed md_line_start md_line_end"><a class="md_compiled" href="https://developers.weixin.qq.com/miniprogram/dev/api/custommsg/conversation.html">点击查看微信小程序的接口文档</a></span>
</p>

</blockquote>
<table>
 <thead><tr><th style="text-align:left">字段</th>
<th style="text-align:left">内容</th>
 </tr>
</thead>
 <tbody><tr><td style="text-align:left">msgtype </td>
<td style="text-align:left">  link</td>
</tr>
<tr><td style="text-align:left">title </td>
<td style="text-align:left"> 点击购买《xxxxxx》</td>
</tr>
<tr><td style="text-align:left">description </td>
<td style="text-align:left"> {课程简介}</td>
</tr>
<tr><td style="text-align:left">url </td>
<td style="text-align:left"> 购买的课程的 H5 的 URL，URL中的渠道号参数为小程序的渠道号</td>
</tr>
<tr><td style="text-align:left">thumb_url </td>
<td style="text-align:left"> 课程列表里的图片</td>
</tr>
</tbody> 
</table>
<!--block_code_end-->
            </div>
        </div>
        

    </div>

</div>





<div class="sidebar_clicker click_to_close_sidebar">
    <span class="bar"></span>
</div>




<script type="text/javascript" src="../asset/fit/jquery.js"></script>
<script type="text/javascript" src="../asset/fit/sidebar/auto_sidebar.js"></script>





<script>
    run_sidebar("left", 'sidebar', 270, "show");

    $(document).ready(function(){
        var sidebar = $('.index_body'); var current = $('.index_body .active');
        if (sidebar.length && current.length){ sidebar.scrollTop(current.offset().top - sidebar.height()/2 + 100);}
    })
</script>



</body>

</html>